<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>2048 小游戏 · 2171213.xyz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: "PingFang SC","Microsoft YaHei",Arial,sans-serif;
  background: #faf8ef;
  text-align: center;
}

h1 {
  margin-top: 20px;
  color: #776e65;
}

#game {
  width: 300px;
  height: 300px;
  margin: 20px auto;
  background: #bbada0;
  border-radius: 10px;
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 10px;
}

.cell {
  background: #cdc1b4;
  border-radius: 6px;
  font-size: 32px;
  font-weight: bold;
  color: #776e65;
  display: flex;
  justify-content: center;
  align-items: center;
}

.n2 { background: #eee4da; }
.n4 { background: #ede0c8; }
.n8 { background: #f2b179; color: #fff; }
.n16 { background: #f59563; color: #fff; }
.n32 { background: #f67c5f; color: #fff; }
.n64 { background: #f65e3b; color: #fff; }
.n128 { background: #edcf72; color: #fff; font-size: 24px; }
.n256 { background: #edcc61; color: #fff; font-size: 24px; }
.n512 { background: #edc850; color: #fff; font-size: 24px; }
.n1024 { background: #edc53f; color: #fff; font-size: 22px; }
.n2048 { background: #edc22e; color: #fff; font-size: 22px; }

button {
  margin-top: 15px;
  padding: 10px 30px;
  border: none;
  border-radius: 30px;
  background: #8f7a66;
  color: #fff;
  font-size: 14px;
}

a {
  display: inline-block;
  margin-top: 20px;
  text-decoration: none;
  color: #776e65;
  font-size: 14px;
}
</style>
</head>

<body>

<h1>2048</h1>

<div id="game"></div>

<button onclick="init()">重新开始</button><br>
<a href="index.html">← 返回首页</a>

<script>
let board = [];

function init() {
  board = Array.from({length:4}, () => Array(4).fill(0));
  addNumber();
  addNumber();
  render();
}

function addNumber() {
  let empty = [];
  for (let i=0;i<4;i++) {
    for (let j=0;j<4;j++) {
      if (board[i][j] === 0) empty.push([i,j]);
    }
  }
  if (!empty.length) return;
  let [x,y] = empty[Math.floor(Math.random()*empty.length)];
  board[x][y] = Math.random() < 0.9 ? 2 : 4;
}

function render() {
  const game = document.getElementById("game");
  game.innerHTML = "";
  for (let i=0;i<4;i++) {
    for (let j=0;j<4;j++) {
      const v = board[i][j];
      const div = document.createElement("div");
      div.className = "cell" + (v ? " n"+v : "");
      div.textContent = v || "";
      game.appendChild(div);
    }
  }
}

function slide(row) {
  row = row.filter(v => v);
  for (let i=0;i<row.length-1;i++) {
    if (row[i] === row[i+1]) {
      row[i] *= 2;
      row[i+1] = 0;
    }
  }
  return row.filter(v => v).concat(Array(4-row.filter(v=>v).length).fill(0));
}

function rotate(times) {
  for (let t=0;t<times;t++) {
    board = board[0].map((_,i)=>board.map(r=>r[i]).reverse());
  }
}

function move(dir) {
  let old = JSON.stringify(board);
  if (dir==="left") {
    board = board.map(r => slide(r));
  }
  if (dir==="right") {
    board = board.map(r => slide(r.reverse()).reverse());
  }
  if (dir==="up") {
    rotate(1); board = board.map(r => slide(r)); rotate(3);
  }
  if (dir==="down") {
    rotate(3); board = board.map(r => slide(r)); rotate(1);
  }
  if (JSON.stringify(board)!==old) {
    addNumber();
    render();
  }
}

document.addEventListener("keydown", e => {
  if (e.key==="ArrowLeft") move("left");
  if (e.key==="ArrowRight") move("right");
  if (e.key==="ArrowUp") move("up");
  if (e.key==="ArrowDown") move("down");
});

init();
</script>

</body>
</html>